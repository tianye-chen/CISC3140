.mode csv
.headers on
.output extract1.csv

CREATE TABLE Cars(Timestamp text, Email text, Name text, Year int, Make text, Model text, Car_ID int not null primary key);

CREATE TABLE Judges (Car_ids int not null, Judge_ID int , Judge_Name text);

CREATE TABLE Car_Score(Car_ids int not null primary key, Racer_Turbo int, Racer_Supercharged int, Racer_Performance int, Racer_Horsepower int, Car_Overall int, Engine_Modifications int, Engine_Performance int, Engine_Chrome int, Engine_Detailing, Engine_Cleanliness int, Body_Frame_Undercarriage int, Body_Frame_Suspension int, Body_Frame_Chrome int, Body_Frame_Detailing int, Body_Frame_Cleanliness int, Mods_Paint int, Mods_Body int, Mods_Wrap int, Mods_Rims int, Mods_Interior int, Mods_Other int, Mods_ICE int, Mods_Aftermarket int, Mods_WIP int, Mods_Overall int);

CREATE TABLE Car_Total (Car_ids primary key, Total int);

.import --skip 1 ./cars.csv Cars
.import --skip 1 ./judges.csv Judges
.import --skip 1 ./car_score.csv Car_Score

INSERT INTO Car_Total (Car_ids, Total)
    select Car_ids, (Racer_Turbo + Racer_Supercharged + Racer_Performance + Racer_Horsepower + Car_Overall + Engine_Modifications + Engine_Performance + Engine_Chrome + Engine_Detailing + Engine_Cleanliness + Body_Frame_Undercarriage + Body_Frame_Suspension + Body_Frame_Chrome + Body_Frame_Detailing + Body_Frame_Cleanliness + Mods_Paint + Mods_Body + Mods_Wrap + Mods_Rims + Mods_Interior + Mods_Other + Mods_ICE + Mods_Aftermarket + Mods_WIP + Mods_Overall) as Total from Car_Score;

SELECT Timestamp,Email,Name,Year,Make,Model,Car_ID,Judge_ID,Judge_Name,Racer_Turbo,Racer_Supercharged,Racer_Performance,Racer_Horsepower,Car_Overall,Engine_Modifications,Engine_Performance,Engine_Chrome,Engine_Detailing,Engine_Cleanliness,Body_Frame_Undercarriage,Body_Frame_Suspension,Body_Frame_Chrome,Body_Frame_Detailing,Body_Frame_Cleanliness,Mods_Paint,Mods_Body,Mods_Wrap,Mods_Rims,Mods_Interior,Mods_Other,Mods_ICE,Mods_Aftermarket,Mods_WIP,Mods_Overall, Total,
    DENSE_RANK () OVER (
        ORDER BY Total DESC
    ) Ranks
    FROM Cars 
        inner join Judges on Judges.Car_ids = Cars.Car_ID 
        inner join Car_Score on Car_Score.Car_ids = Cars.Car_ID 
        inner join Car_Total on Car_Total.Car_ids = Cars.Car_ID;







